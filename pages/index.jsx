import Head from "next/head";
import Prueba from '../pages/components/Prueba'
import { useState, useEffect } from "react";

export default function Home() {

  const [morfologiamandibulas, setMorfologiamandibulas] = useState([])
  const [pesomandibulas, setPesomandibulas] = useState([])
  const [cargaDatos, setCargaDatos] = useState(false);
  const [limitMorfo,setLimitMorfo] = useState(2)
  const [limitPesos,setLimitPesos]= useState(2)

  const getData = async () => {
    let dev = process.env.NODE_ENV !== 'production';
    //const DEV_URL = process.env.DEV_URL;
    //const PROD_URL = process.env.PROD_URL;

    let DEV_URL = "http://localhost:3000" 
    let PROD_URL = "https://laofdb.vercel.app/"

    let response = await fetch(`${dev ? DEV_URL : PROD_URL}/api/muestras`, {headers:{collection: "morfologiamandibulas",limit : limitMorfo} } )
    let data = await response.json()
    console.log("--",data.message,"--")

    setMorfologiamandibulas(data.message)
    //console.log("--",data,"--")
    
    let response2 = await fetch(`${dev ? DEV_URL : PROD_URL}/api/muestras`, {headers:{collection: "pesomandibulas",limit : limitPesos} } )
    let data2 = await response2.json()
    console.log("--",data2.message,"--")
    setPesomandibulas(data2.message)
  }

  useEffect(() =>{
    if (cargaDatos)
      getData()
  },[cargaDatos])

  useEffect(() =>{
    console.log("1->",morfologiamandibulas,pesomandibulas,"<-1")
    console.log("2->",typeof morfologiamandibulas,typeof pesomandibulas,"<-2")
    morfologiamandibulas.map(e => {console.log(e)})

  },[morfologiamandibulas, pesomandibulas])

  const handleLoadData = () => {
    setCargaDatos(!cargaDatos)
  }

  //<Prueba morfologiasMandibulas={morfologiamandibulas} dataPesomandibulas={pesomandibulas}></Prueba>

  return (

    <div>
      <Head>
        <title>DB</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <button className="btn" onClick={handleLoadData}>
          Cargar BD
      </button>
      
      <label>Total de datos para Morfologías:</label>
      <input 
      type='number' 
      value={limitMorfo} 
      onChange={e => setLimitMorfo(e.target.value)}
      >

      </input>

      <p>Aquí se pondrán los campos de búsqueda definidos por hooks</p>
      <p>Se podrá elegir entre diferentes BD y hacer búsqueda por ID, nombre, etc.</p>

      <main className="container">
        {cargaDatos ? 
            <Prueba morfologiasMandibulas={morfologiamandibulas} dataPesomandibulas={pesomandibulas}></Prueba>
            :
            <h1>Cargando</h1>
        }


      </main>
   
     
    </div>
  );
}
